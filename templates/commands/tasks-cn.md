---
name: tasks
description: "将实现方案细化为可执行任务。这是规范驱动开发流程的第三步。"
---

将实现方案细化为可执行任务。

这是规范驱动开发（Spec-Driven Development）流程的第三步。

根据作为参数提供的上下文，执行以下操作：

1. 在仓库根目录运行 `scripts/check-task-prerequisites.sh --json`，解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表。所有路径均需为绝对路径。
2. 加载并分析可用设计文档：
   - 必读 plan.md，获取技术栈和依赖库
   - 如有 data-model.md，读取实体定义
   - 如有 contracts/，读取 API 接口定义
   - 如有 research.md，参考技术决策
   - 如有 quickstart.md，获取测试场景

   注意：并非所有项目都有上述全部文档。例如：
   - CLI 工具可能没有 contracts/
   - 简单库可能无需 data-model.md
   - 任务生成需基于实际可用文档

3. 按模板生成任务：
   - 以 `/templates/tasks-template.md` 为基础
   - 用实际任务替换示例任务，具体包括：
     * **初始化任务**：项目初始化、依赖安装、代码规范
     * **测试任务 [P]**：每个 contract 一个测试任务，每个集成场景一个测试任务
     * **核心任务**：每个实体、服务、CLI 命令、接口各自一个任务
     * **集成任务**：数据库连接、中间件、日志等
     * **完善任务 [P]**：单元测试、性能优化、文档补全

4. 任务生成规则：
   - 每个 contract 文件 → 一个 contract 测试任务，标记 [P]
   - data-model 中每个实体 → 一个模型创建任务，标记 [P]
   - 每个 endpoint → 一个实现任务（如涉及同一文件则不可并行）
   - 每个用户故事 → 一个集成测试任务，标记 [P]
   - 不同文件可并行 [P]
   - 同一文件需串行（不标 [P]）

5. 按依赖关系排序任务：
   - 初始化任务最先
   - 测试任务优先于实现（TDD）
   - 先建模型再做服务
   - 先服务再接口
   - 核心任务优先于集成任务
   - 所有任务完成后再做完善

6. 展示可并行执行的任务示例：
   - 将可并行的 [P] 任务分组
   - 展示实际 Task agent 命令

7. 在 FEATURE_DIR/tasks.md 中生成任务清单，内容包括：
   - 正确的功能名称（来自实现方案）
   - 编号任务（T001、T002 等）
   - 每个任务对应的文件路径
   - 依赖说明
   - 并行执行指引

任务生成上下文：{ARGS}

生成的 tasks.md 应可直接执行——每个任务都要具体明确，确保 LLM 无需额外上下文即可完成。